/*
Copyright The Finder2D Authors

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

	http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

package finder2d_test

import (
	"bytes"
	"fmt"
	"log"

	"github.com/johandry/finder2d"
)

func Example() {
	var on, off byte
	on = []byte(`+`)[0]
	off = []byte(` `)[0]
	percentage := 80.0
	delta := 1

	// Create the Finder2D
	finder := finder2d.New(on, off, percentage, delta)

	// Load the frame or source matrix
	frameReader := bytes.NewBufferString(frame)
	if err := finder.LoadSource(frameReader); err != nil {
		log.Fatalf("[ERROR] fail to load the source matrix. %s", err)
	}

	// Load the image or target matrix
	imageReader := bytes.NewBufferString(target)
	if err := finder.LoadTarget(imageReader); err != nil {
		log.Fatalf("[ERROR] fail to load the target matrix. %s", err)
	}

	// Search the target in the source
	if err := finder.SearchSimple(); err != nil {
		log.Fatalf("[ERROR] failed to search the target matrix. %s", err)
	}

	// Print the matches in JSON
	fmt.Println(finder)

	// Output: [{"X":80,"Y":0,"Percentage":99.11111111111111},{"X":45,"Y":1,"Percentage":97.77777777777777},{"X":42,"Y":40,"Percentage":95.55555555555556},{"X":84,"Y":49,"Percentage":91.55555555555556},{"X":47,"Y":80,"Percentage":92.44444444444444},{"X":84,"Y":84,"Percentage":91.55555555555556}]
}

const frame = `++++++++++++++ +++++  +++++  +++++++++++ +++ ++++++++++++++++++++++ +++++++ ++ ++             ++++++
+++++++++++++++++++++++++++++++++++++++++ +++++            ++++++++++++ +++  + ++++         ++++++++
++ +++++++ ++++++++ ++++++++++++++++++++++++++++         +++++++ +++ ++++++++ ++ +++++++++++++ ++ ++
++++++++++++++ + + +++++ +++++ ++++++ ++ ++++ +++++++++++++ ++++ +++ ++++ ++ +++ ++         +  ++ ++
+ +++++++++ ++++++++++++++++++ ++++ ++   + +++++         ++ +++  +++++++ ++++ ++++  +     +  +++++++
++++ +++++++++ ++++++++++++++ +++ +++++++++++++  +     + +++++++++++++++++++++++++ +++   +++ +++++++
+++++++++++++ +++++++++++++++++++++   ++++++ ++ +++   +++ +++++++++++ + ++++++++++           +++ +++
++ +++++++++++++ +++++++++++ ++++++ +++++++++++            ++ +++++++++++++ ++++ ++   +++   ++  ++++
+++++ +  ++++ ++++ ++++++++++++++  ++++++++++ ++   +++   ++ +++++++++ ++++++ + + ++         ++ +++ +
++++++++++++++++ ++++++++ ++++++++++++++++++  ++         ++ ++++++  ++++++++++++  ++ +   + ++  +++++
++++++ ++++ +++++++ +++++++++++++++ ++++++  +  ++ +   + ++  + ++++++++ ++++++++   ++  +++  ++  ++  +
++++++++++++++++++ +  +++ ++++++++ +++ +++++   ++  +++  ++  +++++++++ ++++++++++   ++     ++    ++++
+++++ ++++++++++  + +++++++++++ ++++++++ ++++   ++     ++     +++++++++++++++ ++     +++++     ++ ++
++ + +++++ ++ ++ +++++++++ + ++++++++++++++++ +   +++++     ++++++++++ +++++++++            +  ++++
++++++++++ +++++ +++++++++++++++++ +++ ++++ +                + ++++  +++++++++++               +++++
++++++++++++  ++++++++++++++ ++++++++ ++++ ++               +++++++ ++++++++++++  ++ ++ ++++++ + +++
+++++++++++ +++++++++++++ ++++ ++++++++++++++++++++++++++++ +++++++++++++++++++++++ ++++++++ +  ++ +
++++++++++ ++++ +++++ +++++++ + +++++++++++++++  +++++++++++++++++++++++ +++++++ +++ +++++++++++++++
+++++ ++++ ++ + +++++++ +++++++++++++++ ++ ++++++++++++++++++++++ +++++ +++++ ++++++++++++++ +++++++
++++  ++ +++++++++++++++++++++++ +++++  ++++++++++++++++++ ++++++++  +++ ++++++++++++  +++++++++++++
++++++++ ++ ++++++++++ ++++ ++ +++ ++++++++++++++++++++++++ +++ +++  +++  ++++++ ++  ++ ++ +++++++++
++++++++ +++++++++++ + +++ +++++++++++++++++++++++  ++++ + +++ +++++++++++++++++++++++++  +++++++++
  + +++++++ +++++++++++++++++ + +++ ++++++++ ++++++++++ ++++ + +++++++++++++++ ++++++++ ++++++++++ +
+++++++++++++++ ++++++++ ++++++++++++++++++++ ++++  + +++++++ +++ ++ ++++++++++++++++++++++++ ++++ +
++ +++++++++  +++++++++++ ++++++++++ +++++++++++++ +++++  +++++++++++++++++++++++++++++++ ++++++++++
+++++++++  +++++++++  ++++++++++++++++++++++++++++++++++++++++++++++++++ ++++++++ +++++++++ ++++++++
+++++ ++ +++++++++++++ +++++++++++++++++++++++++++ ++++++  +++++++++++ ++++++ ++ ++++++++++++++++ ++
++++++++ +++++++++++++++++++ ++++++++++++++++ ++++++++++++++++++++++++++++++++++++++++++++++ ++  +++
+++++++++++++++ +++++ ++++ +++++ +++++++++ ++++++++++ +++++++++ ++++++++++ + +++++++++++++++++++ +++
++ +++ ++++++++++++ +++++++++++++ +++++++++++++++++++++++ +++++++++++++ +++ ++ ++++ + +++++ +++ ++++
+++++++ ++ +  + +++++++++++++++ + ++++ ++++ +++++++++ +++++++++++++++ +++++++++++++++++ +++++  ++ ++
+++++++ +++++++++++++++++++++ +++  + + + +++++++ +++++++++++++++ +++++++ + +++++++++++++++++++++++++
++++ ++++++++ +++++++++ +++++++   +++++++++++++++++++++++ ++ +++ ++ ++ + +++++  +++++++++ ++++++++++
++++++ ++++++ ++ ++++++++++ +++++++++++++++  +++++++++++++ + + + +++++++ + +++++++++++++++++++++++++
+++++++ ++++++ +++++ +++++++ +++++  + ++++ + ++++++++ +++++++++++++++++ +++ +++++ +++++ ++++   +++++
++++++++ +++++++++++++++++++ ++++ +++ ++++++++++ + ++++++++++ +++++ +++++++ + ++ ++++ ++++++++++++ +
++++++++++++++++ ++++++++++++++ +++++++++++ +++++++++++++++ +++++++++++++ ++++++++++++++++++++++++++
+++ ++++++++ + ++++++++ +++++++  +++++++++++++++++++ +++++++ + ++++ ++++ +++++++++  ++++++++++++ +++
++++++++++++ + +++++++++++++++++++++++++++++++ ++ ++ ++++ +++++++++++++ ++++++ ++++++++++ ++++++++++
++ +++ +++++ ++++++++++++++++++++ +++++++ +++++++++  +++++++ +++ ++++++++++++++++++ + ++++++++ ++++
+++++ +++++++++++  +++++++++++++++++++++++++      +     ++++++++++++++++ +  +++  +++++++ +++++++++++
+++++++ ++++++++++++ ++ ++++++++++++++++ ++++         +++++++++++++++++++++++++++ ++++++ ++++++  + +
+++ ++ ++ +++ ++++++++++++++++++++++++++++ +++++++++++++ ++++++++++ ++++++++ +++++++++ +++ +++  +++
+++++++ +++++++++++ ++++++++++++++ ++  +++ ++         ++ +++++ +++++++++++ ++++  ++++  ++++++++++++
++++++++ +++ ++++++  +++ +++++ ++++++ ++++++  +     +  ++++ + ++++++++ ++ +++++++++++++++++++++ ++++
+++++  + + ++++++++++++++ +++++++++++++++ ++ +++   +++ + +++++ ++ + +++ ++ ++++++ +++++ ++++ +++++ +
++++ ++++ +++ +++++ ++++++++ ++++++++++++++           ++++++++++++++++++++++++++++++++++++ + ++++ +
++ ++ ++++ + ++++ ++ +++++++++++++++++++++ ++   +++   ++ + +++++++++ + +++++++  ++++++++++++ +++++++
+++++++++++++++ +++++++++++++++++ + ++++++ ++    +  + ++ ++++++++++++++++++++++++++++++++++++++ ++++
+++++++++++ ++ ++++++++++++++++++++ ++++++  ++     + ++  +++++ ++++++++  ++++++ ++ ++              +
++++++++++++++++  ++++++ +++++++++++++ ++   ++  ++   ++  +++ +++++++++++ ++++++++++++++    +    ++++
++++++++++++ ++++ ++ ++++++++ +++++++ ++++   ++     +++   ++ +++++++++++++++++++++ + ++++++++++ ++ +
+++++ ++++++++ ++++++++++++++++++++++++++      +++++     ++++++++ ++++++++++++++++++ ++     +   ++ +
++ +++ ++++++++++++++++++++++ ++++ ++++++                + + ++++++++ ++++++ ++++ ++++  +     +  +++
++ ++++++++++++  ++++++++++++++++++ ++ ++                +++ +++++++++++++++ + +++++++ +++   +++ +++
+++++++++++++ ++++++++++++++++++++++   +++++++++++ +++++ +++++++++++++++++++ ++++++ ++ +         +++
+ +++ +++ +++++++++  +++++ ++++++ +++++++++++ ++ ++++ +++ +++ +++++++++++ ++++++++++ ++   + +   ++ +
  ++++++++++++ ++ ++ +++ + + + + +  +++++++ ++++++++ +++ ++++++ +++++++++ ++++ +++++ ++         ++
++++++++ + +++++ +++ ++++ +++++  ++++++++++++ +  +++++++++++  ++ +++++++++++++++ +++  ++ +   + ++  +
+++ ++  +++++++++++ +++++++++++ +++++++++++++++++++++ +++++ +++++++++++++++++++++++  ++  +++ +++  +
++++ +++ +++++++++++++++++++++++++++ +++++++++++ ++++++++++++ ++++++++++ + + ++++ +   ++     ++   +
+ ++++++++++++++++++++++  +++++  +++++++ +++++++++++++ +++++++++++++++++++++++++++ +     +++++     +
+++++++ +++++++++++++++++++++ ++++++++++++++ +++ ++++++++++++++++++++++ + ++++++++++               +
+++ + ++++ + ++ + +++++ +++++++++++++++++++++++  +++++++++++++++++++++++++++++++++++               +
++++++ ++++++++++++++++++++++++++ ++ + + ++++++++++++++++++++++++++++ +++++++++++ +  ++++++++++++++
++++++++++ +++++++++++++++++++++++++++++++ +++ +++ +  +++++++ +++++++++++  +++ + +++++++++++ ++++++
++++++++++++++ +++++++ ++ + +++++  +++++++++++++ ++++ +++ +++++++ ++ ++++++++ +++ +++++++ +++++++++
++  ++++++++ +++++++++ +++++++++ +++++ +++++++++ ++++ + + +++++++++ ++  +++++++++++ +++ + ++++++++ +
+++++++++++++ +++ ++++++++++++++++ ++++++++++ +++++++++++++++ +++++++++++ +++ +++++ +++++++ ++++++++
++++++++++ +++++++++++++++++++++++++ ++++++ ++++++++++++++++ +++ ++ ++ +++++++++++++++++++++++++++++
+ +++ + ++++++++++++ ++++++ ++ ++++++++ +++++++++++++++ +++++++++++++++++ +++++ +++++++++++++++++++
++++ ++ ++ ++++++  +++ ++++++++++++++ + +++++++++++++++++++++++++++ + +++++ ++++++++++++++++++++ +++
+ ++++ ++++ ++++++++++++++++  +++++++++++ + + ++ +++++ +  ++ +++ + +++++++++ +++++++++ ++++++++ ++++
++++++ ++++++++++ ++ ++ ++++++++ ++++++++ +++++    + ++++++ ++++++ ++ + +  +++++++ ++++ +++ +++ ++++
++++++ +++++++++++++++++++++ +++ ++++++++++++++++++++++++++++++++++++ +++++++++++++++++++++++ ++ +++
++++++++++++++ ++++++  + ++++++++++++ +++++ +++++++ + + +++++++ ++++++++++++++ ++ ++++++++++++++++++
+++++++++++++++ ++++++ +  ++ + ++++ + +++  +++++ ++++++ +++ ++++++++++++++++++ +++++++++++++++ +++++
++ ++++++++++ +++ +++++++++ +++++++++++++++++++++++++++++++  +++++++++ +++++++++++++++ +++++++++++++
++++ ++++++++ ++ +++++++++ +++++++++++++ +++++ +++++++++  ++ ++++++++++++++++++ +++ ++++++++ + ++++
+++ ++ ++++++++++++++++ +++++++++++++++++++ +++++++++++++++++++++ +++ +++ ++++++++ ++++++++++ ++++++
+ + ++++++++++++++++++++++++++++ ++++ ++++++++++             ++++ ++ +++++ +++++++++++++++++++++ +++
+++ +++++++++++++ ++ ++++++++++++++++++ + +++ +++         +++++ ++++++++++++ +++++++ + ++++++   ++
++++++++ ++++ ++++++++++ ++++++++++++++++++++++ +++++++++++ + ++++++++++++++ +++++++ ++++++  +++++++
++++++++++++++ +++++ ++++++++++++++++++ +++++++ ++         ++ ++++++++++++++++   +++ +++++++++++++++
++++ ++++++ ++++ ++++++++++++++++++++++++++++++++  +     +  ++++ +++++ ++  +++++++ ++             +
++++++++++++++++++++++++++++++++++++++++++++ +++ +++   +++ ++++++++++++ ++++++++++ +++         ++++
+ ++++++++   +++++++++++ ++++++++++ + +++++ ++ ++           ++++ +++++++++++++++++++ +++++++++++++ +
++++++++ ++++++++++++++++++++ +++++++++  ++++++ ++   +++   ++ +++++ + +++++++++++++  ++         ++ +
++++++++++++++++++++++ +++++++++++++ ++++++ +++ ++         ++ + ++++++++ +++++++++++ +  +     +  +++
+ +++++++++++++  ++++++++++++++++++++++++++++++  ++     + ++    +++++++ +++++++ + ++++ +++   +++ +++
++++  ++++++++ ++ +++++++++++++++ +++++++++++++  ++  +++  ++  ++++++++++++++++++++++++        +  +++
++++++ +++++++++++++++++++  ++ ++  +++ + ++  +   ++     ++   ++++++++++ ++++++ +++  ++   +++   ++ +
+++++++++++++++++++ ++++++++++ ++++++++++++++++     +++++     + ++++++++++++ +++++++ ++         ++ +
++++++++++++++++++  + ++ +++++++++++++ ++++++++               + ++++++++++++++ + +++  ++ +   + ++  +
++++++ ++++++++++++++++++++++++++ + ++ ++++++ +          +   ++ +++++++++++++ + +++  ++  +++  ++  +
++++++ +++++++++++++++ +++++++ ++++++++ + ++++++++++++++++++++++++++++++++++++++++++   ++     ++   +
++++++++++++++ +++++  ++ +++++++++ ++++ ++++++++++++++++++++++++++ +++++++++++++++++     + +++     +
  +++++++++++++++++ ++++ + ++++++++++ +++++++++++++++++++++++ +++++++++++++++  +++++               +
++ +++++++++++++ ++++ +++  ++++  +++++++++ +++++++++++++++++++++++ ++++++++ ++++++++               +
++++++++++++++++++++++++++ +++++++ ++++++++++++++++++++++ ++++++++ +++++++++++++++++++++++++++++++++
`

const target = `+             +
+++         +++
 +++++++++++++
 ++         ++
++  +     +  ++
++ +++   +++ ++
++           ++
 ++   +++   ++
 ++         ++
  ++ +   + ++
  ++  +++  ++
   ++     ++
     +++++

               
`
